## Promise(原理)

- 三种状态

```js
// pending(等待) resolved(成功) rejected(失败)
// pending => resolved 或者 pending => rejected
// 变化不可逆, 没发把成功变成失败

// 刚定义时，状态默认为 pending
const p1 = new Promise((resolve, reject) => {})

// 执行 resolve() 后，状态变成 resolved
const p2 = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve()
  })
})

// 执行 reject() 后，状态变成 rejected
const p3 = new Promise((resolve, reject) => {
  setTimeout(() => {
    reject()
  })
})
```

- 状态的表现和变化

1. `pending` 状态, 不会触发 then 和 catch

2. `resolve` 状态, 会触发后续的 then 回调函数

3. `rejected` 状态, 会触发后续的 catch 回调函数

- then 和 catch 对状态的影响

1. `then` 正常返回 resolved, 里面有报错则返回 rejected

2. `catch` 正常返回 resolved, 里面有报错则返回 rejected

> 题目演示

[![cvTChF.png](https://z3.ax1x.com/2021/04/25/cvTChF.png)](https://imgtu.com/i/cvTChF)

```js
// 打印 1，3
Promise.resolve()
  .then(() => {
    console.log(1)
  })
  .catch(() => {
    console.log(2)
  })
  .then(() => {
    console.log(3)
  })

// 打印 1，2，3
Promise.resolve()
  .then(() => {
    console.log(1)
    throw new Error('err')
  })
  .catch(() => {
    console.log(2)
  })
  .then(() => {
    console.log(3)
  })

// 打印 1，2
Promise.resolve()
  .then(() => {
    console.log(1)
    throw new Error('err')
  })
  .catch(() => {
    console.log(2)
  })
  .catch(() => {
    console.log(3)
  })
```

```js
// then() 一般正常返回 resolved  状态的 promise
Promise.resolve().then(() => {
  return 100
})

// then() 里抛出错误，会返回 rejected 状态的 promise
Promise.resolve().then(() => {
  throw new Error('err')
})
```

## async/await

- 异步回调地域(场景)

- Promise, then, catch 是链式调用, 但也是基于回调函数

- async/await 是同步语法, 彻底消灭回调函数

## async/await 和 Promise 的关系

- 执行 async 函数, 返回的是 Promise 对象

- await 相当于 Promise 的 then

- try...catch 可以捕获异常, 代替了 Promise 的 catch
